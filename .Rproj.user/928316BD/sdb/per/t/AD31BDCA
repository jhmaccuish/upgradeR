{
    "collab_server" : "",
    "contents" : "//----------------------------------------------//\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n**\t\t\t\t\tD Sturrock\t\t\t\t\t**\n**\t\t\t\t\tNovember 2016\t\t\t\t**\t\t\t\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n\n//----------------------------------------------//\n* set globals *\n\nrun \"globals.do\"\ncd \"C:\\Users\\Uctphen\\Dropbox\\SourceCode\\upgradeProject\\Stata\"\n\n* setup *\nclear all\n*set maxvar 10000\nset more off\n\n* load data *\nuse \"$data/cleaned_data_waves1-8.dta\"\n\n\n*Larget sample\nkeep if female == 1\nkeep if age >= 52 & age <= 75\n\n\n\n//----------------------------------------------//\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n**\t\t\t\t\tGraphs\t\t\t\t\t\t**\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n//----------------------------------------------//\n\n/*\npreserve\n**Check life cycle profile pre reform\nkeep if wave < 5\ncollapse (mean) wpactive, by(age)\ngraph twoway (line wpactive age, lcolor(gs2)) \nexport excel using \"$data/Moments/Moments.xlsx\", sheet(\"By age wave\") sheetreplace firstrow(variables)\nrestore\npreserve\n\n**Check life cycle profile pre reform\n*keep if wave > 4\n*collapse (mean)  bu_non_housing_wlth, by(year_age_SPA age)\n*reshape wide bu_non_housing_wlth, i(age) j(year_age_SPA)\n*graph twoway (line bu_non_housing_wlth60 age, lcolor(gs2)) (line bu_non_housing_wlth61 age, lcolor(gs6))\ncollapse (mean)  bu_non_housing_wlth, by(age)\ngraph twoway (line  bu_non_housing_wlth age, lcolor(gs2)) \nexport excel using \"$data/Moments/AssetMoments.xlsx\", sheet(\"By age wave\") sheetreplace firstrow(variables)\nrestore\npreserve\n\n\n\n** by wave and age **\n*keep if female == 1\n*keep if age >= 52 & age <= 75\n* keep waves 3 to 7 *\nkeep if wave >=3\n*Get post reform profiles by cohort age\ncollapse (mean) wpactive, by(year_age_SPA age over_SPA)\ndrop if age == year_age_SPA & over_SPA ==0\ndrop over_SPA\nreshape wide wpactive, i(age) j(year_age_SPA)\ngraph twoway (line wpactive60 age, lcolor(gs2)) (line wpactive61 age, lcolor(gs6)) (line wpactive62 age, lcolor(blue)) \nexport excel using \"$data/Moments/Lpath52to75.xlsx\", sheet(\"Sheet 1\") sheetreplace firstrow(variables)\nrestore\npreserve\n\nkeep if wave >=3\nkeep if age >= 58 & age <= 63\ncollapse (mean) wpactive, by(year_age_SPA age over_SPA)\ndrop if age == year_age_SPA & over_SPA ==0\ndrop over_SPA\nreshape wide wpactive, i(age) j(year_age_SPA)\ngraph twoway (line wpactive60 age, lcolor(gs2)) (line wpactive61 age, lcolor(gs6)) (line wpactive62 age, lcolor(blue)) \nexport excel using \"$data/Moments/Lpath58to63.xlsx\", sheet(\"Sheet 1\") sheetreplace firstrow(variables)\nrestore\npreserve\n*/\n//----------------------------------------------//\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n**\t\t\tFirst stage regression\t\t\t\t**\n**\t\t\t\t\t\t\t\t\t\t\t\t**\n//----------------------------------------------//\n\n****\t\t\t\t\t\t\t****\n****\tCreate dummies etc\t\t****\n****\t\t\t\t\t\t\t****\n\n* age *\nforvalues t = 56(1)62 {\ngen age_`t' = (age == `t')\n}\n\n* age squared *\ngen sq_age_p = age_p^2\n\n* year and quarter of interview *\nforvalues y = 2002(1)2015 {\n\tforvalues q = 1(1)4 {\n\tgen yqint_`y'q`q' = (yrq_int == tq(`y'q`q'))\n\t}\n}\n\n* generate year-quarter of birth with all positive values *\ngen year_q_birth = yrq_bth + 1000 // this is fine so long as we don't care about being able to read year-quarter effects\n\n* cohort *\nforvalues t = 1939(1)1959 {\ngen cohort_`t' = (y_birth == `t')\n}\n\n* under SPA *\ngen under_SPA = (over_SPA==0)\n\n** fill in value for missing/create missing dummies **\n\n* partner age * // missing dummy exists (couple)\nreplace sq_age_p = 999 if  age_p==.\nreplace age_p = 999 if age_p == .\nreplace partner60_64 = 99 if partner60_64 == .\nreplace partner65 = 99 if partner65 == .\n\n* home owner *\ngen miss_ho = 0\nreplace miss_ho = 1 if home_owner == .\nreplace home_owner = 99 if home_owner == .\n\n* physicality of work *\ngen miss_work_phys = 0\nreplace miss_work_phys = 1 if work_phys == .\nreplace work_phys = 99 if work_phys == .\nreplace phys2 = 99 if phys2 == .\nreplace work_phys3 = 99 if work_phys3 == .\n\n* eduaction *\ngen miss_edu = 0\nreplace miss_edu = 1 if edu_yr == .\nreplace edu_yr = 99 if edu_yr == .\ngen miss_edu_qual = 0\nreplace miss_edu_qual = 1 if edqual == .\nreplace edqual = 99 if edqual == .\nreplace edcat = 99 if edcat == .\nrecode first_edcat1 . = 99\n\n* region *\ngen miss_gor = 0\nreplace miss_gor = 1 if gvt_off_region == .\nreplace gvt_off_region = 99 if gvt_off_region == .\n\n* know SPA *\nrecode SPA_know . = 99\n\nlabel define edq_level 99 \"Missing\", add\n\n** Drop individuals that have stopped working by age 55 **\n*drop if age_lkw < 55 | age_lkw == . // we drop the 267 cases where never work, never report when left last job and never say that never worked.\n\n*save \"$data/data_for_regressions.dta\", replace\n\n\n****\t\t\t\t\t\t\t****\n****\t\tRegressions\t\t\t****\n****\t\t\t\t\t\t\t****\n\n* Create list for controls * edu_p_miss bu_non_housing_wlth\nlocal controls = \"i.marstat age_p_miss age_p sq_age_p partner65 partner60_64 i.edu_yr i.edqual i.home_owner i.qual3_p oneyr_under_SPA oneyr_over_SPA twoyr_under_SPA twoyr_over_SPA bu_non_housing_wlth\"\n\n** Fixed effects estimation **\n\n*sampe selection moved here\nkeep if female == 1\n* keep if aged 58 to 63 **\nkeep if age>= 58 & age<= 63 \n* keep waves 3 to 7 *\n*keep if wave >=3\n\nsave \"$data\\data_for_regressions.dta\", replace\n  \n*gen test = age==year_age_SPA & over_SPA==0 //& individual_net_emp_inc*(-days_over_SPA/7) <= bu_non_housing_wlth\n*bysort idauniq(test) : keep if test[_N]==1\n\n*collapse (mean) days_over_SPA years_over_SPA individual_net_emp_inc bu_non_housing_wlth , by(year_age_SPA age over_SPA)\n* keep if age==year_age_SPA\n*gen test=individual_net_emp_inc*(-days_over_SPA/7)\n\n/*\ngen minus_age = -1* age\nbysort idauniq(under_SPA minus_age) : gen temp =  bu_non_housing_wlth[_N]*under_SPA[_N] \nkeep if temp >= 27300 //21580 -75% percetntile of full time workers pay 415.7044 annualised\nxtset idauniq\nxtreg wpactive under_SPA i.yrq_age i.yrq_int i.y_birth `controls', re \n*/\n\n\ngen constrained = bu_non_housing_wlth - individual_net_emp_inc*(-days_over_SPA/7)\ngen minus_age = -1* age\n*bysort idauniq(under_SPA minus_age) : gen temp =  constrained[_N]\n*bysort idauniq(under_SPA minus_age) : gen tem2 =  constrained[_N]*under_SPA[_N] /* wpactive[_N] */\nbysort idauniq(under_SPA age) : gen tem2 =  constrained[_N]*under_SPA[_N] /* wpactive[_N] */\n\nbysort idauniq(age) : gen fd =  bu_non_housing_wlth - bu_non_housing_wlth[_n-1]\n\n*This is row 4 Same as 3 but additionally add the change in assets between the last period before SPA\n*and the first period after SPA\nbysort idauniq(under_SPA age) : gen temp3 =  fd[1]*over_SPA[1]\n*replace temp3 = 0 if temp3 >=. \n\n\n/*\n*This is row 5 - Same as 3 but additionally add the 25 percentile of the change in assets between the last\n*period before SPA and the first period after SPA (-14,187.50)\nbysort idauniq(under_SPA minus_age) : gen temp3 = -14187.5  * under_SPA[_N] /* -14187.5 is 25 percentile of fd*/\n*/\n\ngen temp4 = tem2 + temp3\n*keep if temp4 >= 0\nkeep if tem2 >= 0\n\n*keep idauniq wave age year_age_SPA under_SPA  over_SPA  individual_net_emp_inc days_over_SPA bu_non_housing_wlth constrained minus age temp tem2\n*sort idauniq age\n\nxtset idauniq\nxtreg wpactive under_SPA i.yrq_age i.yrq_int i.y_birth `controls', re \n*xtreg wpactive under_SPA i.yrq_age i.yrq_int i.fin_y_birth `controls', fe \n\n",
    "created" : 1525696301827.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3039121828",
    "id" : "AD31BDCA",
    "lastKnownWriteTime" : 1525882226,
    "last_content_update" : 1525882226,
    "path" : "~/Dropbox/SourceCode/upgradeProject/Stata/Forked First Stage.do",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "text"
}